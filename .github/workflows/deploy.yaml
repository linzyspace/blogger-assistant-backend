
name: Deploy to Cloud Run
on:
push:
branches: [ main ]


jobs:
build-deploy:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4


- name: Set up Cloud SDK
uses: google-github-actions/setup-gcloud@v1
with:
project_id: ${{ secrets.GCP_PROJECT_ID }}
service_account_key: ${{ secrets.GCP_SA_KEY }}


- name: Build & push image
run: |
gcloud builds submit --tag gcr.io/${{ secrets.GCP_PROJECT_ID }}/blog-assistant-api:latest api


- name: Deploy to Cloud Run
run: |
gcloud run deploy blog-assistant-api \
--image gcr.io/${{ secrets.GCP_PROJECT_ID }}/blog-assistant-api:latest \
--region ${ { secrets.GCP_REGION } } \
--platform managed \
--allow-unauthenticated \
--service-account ${{ secrets.GCP_SA_EMAIL }}
